{% load gym_extras %}
{% for schedule in schedule_list %}
<div class="col">
  <div class="card card-hover h-100 shadow-sm">
    <div class="card-body">
      <!-- Workout Name -->
      <h5 class="card-title mb-3">
        <i class="fas fa-dumbbell text-primary me-2"></i>
        {{ schedule.workout.name }}
      </h5>

      <!-- Date & Time -->
      <div class="schedule-time-badge mb-3">
        <div class="d-flex justify-content-between align-items-center">
          <span>
            <i class="fas fa-calendar-day me-2"></i>
            {{ schedule.start_time|date:"d M Y" }}
          </span>
          <span>
            <i class="fas fa-clock me-2"></i>
            {{ schedule.start_time|date:"H:i" }}
          </span>
        </div>
      </div>

      <!-- Trainer -->
      <div class="mb-3">
        <small class="text-muted d-block mb-1">Trainer</small>
        <div class="d-flex align-items-center">
          <div class="trainer-avatar" style="width: 40px; height: 40px; font-size: 1rem;">
            {{ schedule.workout.trainer.user.first_name|first|upper }}{{ schedule.workout.trainer.user.last_name|first|upper }}
          </div>
          <span class="ms-2 fw-bold">
            {{ schedule.workout.trainer.user.get_full_name }}
          </span>
        </div>
      </div>

      <!-- Availability -->
      {% with available=schedule.capacity booked=schedule.bookings.count spots_left=schedule.capacity|subtract:schedule.bookings.count %}
      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <small class="text-muted">Availability</small>
          <span class="badge {% if spots_left|add:"0" > 0 %}bg-success{% else %}bg-danger{% endif %}">
            {{ spots_left }} / {{ available }} spots
          </span>
        </div>
        <div class="progress" style="height: 6px;">
          <div class="progress-bar bg-gradient-primary"
               role="progressbar"
               style="width: {% widthratio booked available 100 %}%">
          </div>
        </div>
      </div>
      {% endwith %}

      <!-- Actions -->
      <div class="d-flex gap-2">
        <a href="{% url 'gym:schedule-detail' pk=schedule.id %}"
           class="btn btn-primary btn-sm flex-grow-1">
          <i class="fas fa-info-circle me-1"></i>Details
        </a>
        {% if can_manage %}
        <a href="{% url 'gym:schedule-update' pk=schedule.id %}"
           class="btn btn-warning btn-sm">
          <i class="fas fa-edit"></i>
        </a>
        <a href="{% url 'gym:schedule-delete' pk=schedule.id %}"
           class="btn btn-danger btn-sm">
          <i class="fas fa-trash"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% empty %}
<div class="col-12">
  <div class="alert alert-info text-center">
    <i class="fas fa-info-circle me-2"></i>No upcoming classes found.
  </div>
</div>
{% endfor %}

{% if page_obj.has_next %}
<div class="col-12 text-center my-4"
     hx-get="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}"
     hx-trigger="revealed"
     hx-swap="outerHTML"
     hx-select="#schedule-container > *"
     hx-target="#schedule-container"
     hx-swap="beforeend">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
{% endif %}